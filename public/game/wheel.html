<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>íœ ì²´ì–´ ë³´ë„ ëª¨í—˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      overflow: hidden;
      background: #2c3e50;
      font-family: 'Jua', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      touch-action: none;
    }
    #gameContainer {
      position: relative;
      background: #34495e;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    canvas {
      display: block;
      background: #95a5a6;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* ì¡°ì´ìŠ¤í‹± */
    #joystick {
      position: absolute;
      bottom: 40px;
      left: 40px;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.4);
      display: none;
    }
    #joystick.active {
      display: block;
    }
    #stick {
      position: absolute;
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.8);
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.1s;
    }

    /* UI ì˜¤ë²„ë ˆì´ */
    #ui {
      position: absolute;
      top: -45px;
      left: 0;
      width: 100%;
      background: #34495e;
      padding: 8px 15px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      font-size: 16px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
      border-bottom: 3px solid #2c3e50;
    }
    #coinDisplay {
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    #timerContainer {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
    }
    #timerText {
      font-size: 14px;
      font-weight: bold;
    }
    #timeBar {
      width: 150px;
      height: 8px;
      background: #2c3e50;
      border-radius: 4px;
      overflow: hidden;
      border: 1px solid #1a1a1a;
    }
    #timeBarFill {
      height: 100%;
      background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c);
      transition: width 0.3s linear;
      width: 100%;
    }

    /* ì‹œì‘/ì¢…ë£Œ í™”ë©´ */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.8);
      color: white;
      z-index: 10;
    }
    .screen h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    .screen p {
      font-size: 20px;
      margin: 10px 0;
    }
    .screen button {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 24px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Jua', sans-serif;
    }
    .screen button:hover {
      background: #2980b9;
    }
    #endScreen {
      display: none;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <!-- UI -->
    <div id="ui">
      <div id="coinDisplay">
        <span>ğŸª™</span>
        <span id="coinCount">0</span>
      </div>
      <div id="timerContainer">
        <div id="timerText">â±ï¸ <span id="timeLeft">40</span>ì´ˆ</div>
        <div id="timeBar">
          <div id="timeBarFill"></div>
        </div>
      </div>
    </div>

    <!-- ì¡°ì´ìŠ¤í‹± -->
    <div id="joystick">
      <div id="stick"></div>
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="screen">
      <h1>ğŸ¦½ íš¡ë‹¨ë³´ë„ ê±´ë„ˆê¸°</h1>
      <p>ì°¨ë¥¼ í”¼í•´ ì½”ì¸ì„ ëª¨ìœ¼ë©° ê±´ë„ˆí¸ìœ¼ë¡œ!</p>
      <p style="font-size: 16px; color: #bdc3c7;">ì¡°ì´ìŠ¤í‹±ìœ¼ë¡œ ì´ë™</p>
      <button onclick="startGame()">ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- ì¢…ë£Œ í™”ë©´ -->
    <div id="endScreen" class="screen">
      <h1 id="endTitle">ì„±ê³µ!</h1>
      <p id="endMessage">ê²°ìŠ¹ì„ ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!</p>
      <button onclick="resetGame()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // í”Œë ˆì´ì–´ ì´ë¯¸ì§€ ë¡œë“œ
    const playerImage = new Image();
    playerImage.src = 'ìºë¦­í„°.png'; // ê°™ì€ í´ë” ë‚´ íŒŒì¼
    playerImage.onerror = () => console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ìºë¦­í„°.png');
    playerImage.onload = () => console.log('ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ');

    // ê²Œì„ ìƒíƒœ
    let gameState = 'start'; // start, playing, end
    let timeLeft = 40;
    let timerEnabled = true; // íƒ€ì´ë¨¸ í™œì„±í™”
    let coinCount = 0;
    let maxTime = 40;

    // í”Œë ˆì´ì–´
    const player = {
      x: canvas.width / 2,
      y: canvas.height - 65,
      width: 29, // íˆíŠ¸ë°•ìŠ¤ í¬ê¸° (ì¤„ì„)
      height: 29,
      displayWidth: 40, // í™”ë©´ì— ë³´ì´ëŠ” í¬ê¸° (í‚¤ì›€)
      displayHeight: 40,
      velocityX: 0,
      velocityY: 0,
      acceleration: 0.4,
      friction: 0.92,
      maxSpeed: 4,
      image: playerImage
    };

    // ì°¨ì„  ì„¤ì •
    const laneTop = 120; // ìƒë‹¨ ë³¼ë¼ë“œ ì•„ë˜
    const laneBottom = canvas.height - 120; // í•˜ë‹¨ ë³¼ë¼ë“œ ìœ„
    const laneHeight = (laneBottom - laneTop) / 4;
    
    const lanes = [
      { y: laneTop + laneHeight * 0.5, direction: -1 }, // í•˜ë‹¨1: ì˜¤â†’ì™¼
      { y: laneTop + laneHeight * 1.5, direction: -1 }, // í•˜ë‹¨2: ì˜¤â†’ì™¼
      { y: laneTop + laneHeight * 2.5, direction: 1 }, // ìƒë‹¨1: ì™¼â†’ì˜¤
      { y: laneTop + laneHeight * 3.5, direction: 1 }  // ìƒë‹¨2: ì™¼â†’ì˜¤
    ];

    // ì°¨ëŸ‰ ë°°ì—´
    const cars = [];
    const carWidth = 40;
    const carHeight = 20;

    // ì½”ì¸ ë°°ì—´
    const coins = [];
    const coinSize = 12;

    // ë³¼ë¼ë“œ (ì¥ì• ë¬¼) - ì‹œì‘ì ê³¼ ëì ì— ì¼ìë¡œ ë°°ì¹˜
    const bollards = [];
    const bollardRadius = 8; // ì›ì˜ ë°˜ì§€ë¦„
    const startY = canvas.height - 100; // ì‹œì‘ì  (í•˜ë‹¨)
    const endY = 100; // ëì  (ìƒë‹¨)
    const edgeMargin = 15; // í™”ë©´ ë ì—¬ë°±
    
    // ì‹œì‘ì  ë³¼ë¼ë“œ (í•˜ë‹¨ ì¼ì) - ì´ 9ê°œ
    // ì²« ë²ˆì§¸ì™€ ë§ˆì§€ë§‰ì€ ì–‘ìª½ ëì—
    bollards.push({ x: edgeMargin, y: startY, radius: bollardRadius });
    bollards.push({ x: canvas.width - edgeMargin, y: startY, radius: bollardRadius });
    
    // ë‚˜ë¨¸ì§€ 7ê°œëŠ” ê· ë“± ê°„ê²©
    const innerWidth = canvas.width - (edgeMargin * 2);
    const spacing = innerWidth / 8; // 7ê°œë¥¼ 8êµ¬ê°„ì— ë°°ì¹˜
    for (let i = 1; i <= 7; i++) {
      bollards.push({ x: edgeMargin + spacing * i, y: startY, radius: bollardRadius });
    }
    
    // ëì  ë³¼ë¼ë“œ (ìƒë‹¨ ì¼ì) - ì´ 9ê°œ
    bollards.push({ x: edgeMargin, y: endY, radius: bollardRadius });
    bollards.push({ x: canvas.width - edgeMargin, y: endY, radius: bollardRadius });
    
    for (let i = 1; i <= 7; i++) {
      bollards.push({ x: edgeMargin + spacing * i, y: endY, radius: bollardRadius });
    }

    // ê²°ìŠ¹ì„ 
    const finishLine = 60; // 20px ìœ„ë¡œ ì´ë™

    // ì¡°ì´ìŠ¤í‹±
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let joystickActive = false;
    let joystickInput = { x: 0, y: 0 };

    // í„°ì¹˜ ì´ë²¤íŠ¸
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', handleTouchMove);
    canvas.addEventListener('touchend', handleTouchEnd);

    function handleTouchStart(e) {
      e.preventDefault();
      if (gameState !== 'playing') return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const touchX = touch.clientX - rect.left;
      const touchY = touch.clientY - rect.top;
      
      // ì¡°ì´ìŠ¤í‹± í™œì„±í™”
      joystick.style.left = touchX - 60 + 'px';
      joystick.style.top = touchY - 60 + 'px';
      joystick.classList.add('active');
      joystickActive = true;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (!joystickActive) return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const touchX = touch.clientX - rect.left;
      const touchY = touch.clientY - rect.top;
      
      const joystickRect = joystick.getBoundingClientRect();
      const centerX = joystickRect.left + joystickRect.width / 2 - rect.left;
      const centerY = joystickRect.top + joystickRect.height / 2 - rect.top;
      
      let deltaX = touchX - centerX;
      let deltaY = touchY - centerY;
      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
      const maxDistance = 35;
      
      if (distance > maxDistance) {
        const angle = Math.atan2(deltaY, deltaX);
        deltaX = Math.cos(angle) * maxDistance;
        deltaY = Math.sin(angle) * maxDistance;
      }
      
      stick.style.left = (60 + deltaX) + 'px';
      stick.style.top = (60 + deltaY) + 'px';
      
      joystickInput.x = deltaX / maxDistance;
      joystickInput.y = deltaY / maxDistance;
    }

    function handleTouchEnd(e) {
      e.preventDefault();
      joystick.classList.remove('active');
      joystickActive = false;
      stick.style.left = '50%';
      stick.style.top = '50%';
      joystickInput = { x: 0, y: 0 };
    }

    // ê²Œì„ ì‹œì‘
    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      gameState = 'playing';
      coinCount = 0;
      document.getElementById('coinCount').textContent = coinCount;
      cars.length = 0;
      coins.length = 0;
      resetPlayer();
      spawnInitialCoins();
      if (timerEnabled) {
        timeLeft = maxTime;
        document.getElementById('timeLeft').textContent = timeLeft;
        startTimer();
      }
      gameLoop();
    }

    // ê²Œì„ ë¦¬ì…‹
    function resetGame() {
      document.getElementById('endScreen').style.display = 'none';
      gameState = 'playing';
      coinCount = 0;
      document.getElementById('coinCount').textContent = coinCount;
      cars.length = 0;
      coins.length = 0;
      resetPlayer();
      spawnInitialCoins();
      if (timerEnabled) {
        timeLeft = maxTime;
        document.getElementById('timeLeft').textContent = timeLeft;
        startTimer();
      }
      gameLoop(); // ê²Œì„ ë£¨í”„ ì¬ì‹œì‘
    }

    function resetPlayer() {
      player.x = canvas.width / 2;
      player.y = canvas.height - 65; // 15px ë’¤ë¡œ ì´ë™ (80 -> 65)
      player.velocityX = 0;
      player.velocityY = 0;
    }

    // ì´ˆê¸° ì½”ì¸ ìƒì„± (ì˜¤ë¥¸ìª½ ì•„ë˜, ê°€ìš´ë°, ì™¼ìª½ ìœ„)
    function spawnInitialCoins() {
      // ì˜¤ë¥¸ìª½ ì•„ë˜
      coins.push({
        x: canvas.width - 80,
        y: canvas.height - 250,
        collected: false
      });
      
      // ê°€ìš´ë°
      coins.push({
        x: canvas.width / 2,
        y: canvas.height / 2,
        collected: false
      });
      
      // ì™¼ìª½ ìœ„
      coins.push({
        x: 80,
        y: 250,
        collected: false
      });
    }

    // ì°¨ëŸ‰ ìƒì„±
    let lastCarSpawn = 0;
    function spawnCar() {
      const now = Date.now();
      if (now - lastCarSpawn < 800) return; // ìµœì†Œ ê°„ê²©
      
      const randomInterval = Math.random() * 1500; // ë¶ˆê·œì¹™ íƒ€ì´ë°
      if (Math.random() < 0.3) { // 30% í™•ë¥ ë¡œ ìƒì„±
        const lane = lanes[Math.floor(Math.random() * lanes.length)];
        const speed = 1.5 + Math.random() * 1.5; // ë¶ˆê·œì¹™ ì†ë„ (1.5~3)
        
        cars.push({
          x: lane.direction === 1 ? -carWidth : canvas.width + carWidth,
          y: lane.y,
          width: carWidth,
          height: carHeight,
          speed: speed * lane.direction,
          lane: lane
        });
        
        lastCarSpawn = now;
      }
    }

    // ì°¨ëŸ‰ ì—…ë°ì´íŠ¸
    let lastUpdateTime = Date.now();
    function updateCars() {
      const currentTime = Date.now();
      const deltaTime = (currentTime - lastUpdateTime) / 16.67; // 60fps ê¸°ì¤€ ì •ê·œí™”
      lastUpdateTime = currentTime;
      
      spawnCar();
      
      for (let i = cars.length - 1; i >= 0; i--) {
        cars[i].x += cars[i].speed * deltaTime;
        
        // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ì°¨ëŸ‰ ì œê±°
        if (cars[i].x < -carWidth - 50 || cars[i].x > canvas.width + 50) {
          cars.splice(i, 1);
        }
      }
    }

    // íƒ€ì´ë¨¸
    function startTimer() {
      const interval = setInterval(() => {
        if (gameState !== 'playing') {
          clearInterval(interval);
          return;
        }
        timeLeft--;
        document.getElementById('timeLeft').textContent = timeLeft;
        
        // íƒ€ì„ë°” ì—…ë°ì´íŠ¸
        const percentage = (timeLeft / maxTime) * 100;
        document.getElementById('timeBarFill').style.width = percentage + '%';
        
        if (timeLeft <= 0) {
          endGame(false, 'ì‹œê°„ ì´ˆê³¼!');
          clearInterval(interval);
        }
      }, 1000);
    }

    // ë¬¼ë¦¬ ì—…ë°ì´íŠ¸
    function updatePhysics() {
      // ì¡°ì´ìŠ¤í‹± ì…ë ¥ì— ë”°ë¥¸ ê°€ì†
      player.velocityX += joystickInput.x * player.acceleration;
      player.velocityY += joystickInput.y * player.acceleration;
      
      // ì†ë„ ì œí•œ
      const speed = Math.sqrt(player.velocityX ** 2 + player.velocityY ** 2);
      if (speed > player.maxSpeed) {
        const ratio = player.maxSpeed / speed;
        player.velocityX *= ratio;
        player.velocityY *= ratio;
      }
      
      // ë§ˆì°°ë ¥ ì ìš©
      player.velocityX *= player.friction;
      player.velocityY *= player.friction;
      
      // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      player.x += player.velocityX;
      player.y += player.velocityY;
      
      // í™”ë©´ ê²½ê³„ ì œí•œ
      if (player.x < player.width / 2) {
        player.x = player.width / 2;
        player.velocityX = 0;
      }
      if (player.x > canvas.width - player.width / 2) {
        player.x = canvas.width - player.width / 2;
        player.velocityX = 0;
      }
      if (player.y < player.height / 2) {
        player.y = player.height / 2;
        player.velocityY = 0;
      }
      if (player.y > canvas.height - player.height / 2) {
        player.y = canvas.height - player.height / 2;
        player.velocityY = 0;
      }
    }

    // ì¶©ëŒ ê°ì§€
    function checkCollisions() {
      // ë³¼ë¼ë“œ ì¶©ëŒ (ì›í˜•)
      bollards.forEach(bollard => {
        const dx = player.x - bollard.x;
        const dy = player.y - bollard.y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const minDistance = (player.width / 2) + bollard.radius;
        
        if (distance < minDistance) {
          // íŠ±ê²¨ë‚´ê¸°
          if (distance > 0) {
            const pushX = (dx / distance) * 3;
            const pushY = (dy / distance) * 3;
            player.velocityX = pushX;
            player.velocityY = pushY;
          }
        }
      });
      
      // ì°¨ëŸ‰ ì¶©ëŒ
      cars.forEach(car => {
        if (isCollidingCar(player, car)) {
          endGame(false, 'ì°¨ëŸ‰ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤!');
        }
      });
      
      // ì½”ì¸ ìˆ˜ì§‘
      coins.forEach(coin => {
        if (!coin.collected && isCollidingCoin(player, coin)) {
          coin.collected = true;
          coinCount++;
          document.getElementById('coinCount').textContent = coinCount;
        }
      });
      
      // ê²°ìŠ¹ì„  ì²´í¬
      if (player.y < finishLine) {
        endGame(true, `ì½”ì¸ ${coinCount}ê°œë¥¼ ëª¨ì•˜ìŠµë‹ˆë‹¤!`);
      }
    }

    function isCollidingCar(p, car) {
      const pLeft = p.x - p.width / 2;
      const pRight = p.x + p.width / 2;
      const pTop = p.y - p.height / 2;
      const pBottom = p.y + p.height / 2;
      
      const cLeft = car.x - car.width / 2;
      const cRight = car.x + car.width / 2;
      const cTop = car.y - car.height / 2;
      const cBottom = car.y + car.height / 2;
      
      return pLeft < cRight &&
             pRight > cLeft &&
             pTop < cBottom &&
             pBottom > cTop;
    }

    function isCollidingCoin(p, coin) {
      const dx = p.x - coin.x;
      const dy = p.y - coin.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      return distance < (p.width / 2 + coinSize);
    }

    function isColliding(rect1, rect2) {
      const r1Left = rect1.x - rect1.width / 2;
      const r1Right = rect1.x + rect1.width / 2;
      const r1Top = rect1.y - rect1.height / 2;
      const r1Bottom = rect1.y + rect1.height / 2;
      
      const r2Left = rect2.x;
      const r2Right = rect2.x + rect2.width;
      const r2Top = rect2.y;
      const r2Bottom = rect2.y + rect2.height;
      
      return r1Left < r2Right &&
             r1Right > r2Left &&
             r1Top < r2Bottom &&
             r1Bottom > r2Top;
    }

    // ê²Œì„ ì¢…ë£Œ
    function endGame(victory, message) {
      gameState = 'end';
      const endScreen = document.getElementById('endScreen');
      const endTitle = document.getElementById('endTitle');
      const endMessage = document.getElementById('endMessage');
      
      if (victory) {
        endTitle.textContent = 'ğŸ‰ ì„±ê³µ!';
        endMessage.textContent = message || 'ê²°ìŠ¹ì„ ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!';
      } else {
        endTitle.textContent = 'ğŸ’¥ ì‹¤íŒ¨';
        endMessage.textContent = message || 'ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!';
      }
      
      endScreen.style.display = 'flex';
    }

    // ê·¸ë¦¬ê¸°
    function draw() {
      // ë°°ê²½ (íšŒìƒ‰ ë„ë¡œ)
      ctx.fillStyle = '#4a4a4a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // ì°¨ì„  ê·¸ë¦¬ê¸°
      const dashSize = 15;
      const dashGap = 15;
      
      // 1ì°¨ì„  ìƒë‹¨ ì™¸ê³½ì„  (ë…¸ë€ìƒ‰ ì‹¤ì„ )
      ctx.fillStyle = '#f1c40f';
      ctx.fillRect(0, laneTop - 1, canvas.width, 3);
      
      // ì°¨ì„  êµ¬ë¶„ì„ 
      for (let i = 0; i < 4; i++) {
        const lineY = laneTop + laneHeight * (i + 1);
        
        // ì¤‘ì•™ì„  (ì¸ë±ìŠ¤ 1ë§Œ)ì€ ë…¸ë€ìƒ‰ ì´ì¤‘ ì‹¤ì„ 
        if (i === 1) {
          ctx.fillStyle = '#f1c40f';
          // ìœ„ìª½ ì„ 
          ctx.fillRect(0, lineY - 3, canvas.width, 2);
          // ì•„ë˜ìª½ ì„ 
          ctx.fillRect(0, lineY + 1, canvas.width, 2);
        }
        // ë§ˆì§€ë§‰ ì¤„ (ì¸ë±ìŠ¤ 3)ì€ ë…¸ë€ìƒ‰ ì‹¤ì„ 
        else if (i === 3) {
          ctx.fillStyle = '#f1c40f';
          ctx.fillRect(0, lineY - 1, canvas.width, 3);
        }
        // ë‚˜ë¨¸ì§€ (ì¸ë±ìŠ¤ 0, 2)ëŠ” í°ìƒ‰ ì ì„ 
        else {
          ctx.fillStyle = '#ffffff';
          for (let x = 0; x < canvas.width; x += dashSize + dashGap) {
            ctx.fillRect(x, lineY - 1, dashSize, 2);
          }
        }
      }
      
      // ê²°ìŠ¹ì„  (ì²´ì»¤ë³´ë“œ íŒ¨í„´)
      const checkSize = 20; // ê° ì‚¬ê°í˜• í¬ê¸°
      const finishHeight = 15;
      const finishY = finishLine - finishHeight / 2;
      
      for (let x = 0; x < canvas.width; x += checkSize) {
        for (let y = 0; y < finishHeight; y += checkSize) {
          const isWhite = (Math.floor(x / checkSize) + Math.floor(y / checkSize)) % 2 === 0;
          ctx.fillStyle = isWhite ? '#ffffff' : '#000000';
          ctx.fillRect(x, finishY + y, checkSize, Math.min(checkSize, finishHeight - y));
        }
      }
      
      // "ê²°ìŠ¹ì„ " í…ìŠ¤íŠ¸
      ctx.fillStyle = '#f1c40f';
      ctx.font = 'bold 16px Jua';
      ctx.textAlign = 'center';
      ctx.strokeStyle = '#2c3e50';
      ctx.lineWidth = 3;
      ctx.strokeText('ê²°ìŠ¹ì„ ', canvas.width / 2, finishLine + 25);
      ctx.fillText('ê²°ìŠ¹ì„ ', canvas.width / 2, finishLine + 25);
      
      // ë³¼ë¼ë“œ (ì›í˜•, ê²€ì •ìƒ‰ + ë…¸ë€ í…Œë‘ë¦¬)
      bollards.forEach(bollard => {
        // ê²€ì •ìƒ‰ ì•ˆìª½
        ctx.fillStyle = '#2c3e50';
        ctx.beginPath();
        ctx.arc(bollard.x, bollard.y, bollard.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // ë…¸ë€ í…Œë‘ë¦¬ (ì–—ê²Œ)
        ctx.strokeStyle = '#f1c40f';
        ctx.lineWidth = 3;
        ctx.stroke();
      });
      
      // ì°¨ëŸ‰
      cars.forEach(car => {
        ctx.fillStyle = '#e67e22';
        ctx.fillRect(
          car.x - car.width / 2,
          car.y - car.height / 2,
          car.width,
          car.height
        );
        ctx.strokeStyle = '#d35400';
        ctx.lineWidth = 2;
        ctx.strokeRect(
          car.x - car.width / 2,
          car.y - car.height / 2,
          car.width,
          car.height
        );
        
        // ì°½ë¬¸ í‘œì‹œ
        ctx.fillStyle = '#34495e';
        ctx.fillRect(
          car.x - car.width / 4,
          car.y - car.height / 3,
          car.width / 2,
          car.height / 2
        );
      });
      
      // ì½”ì¸
      coins.forEach(coin => {
        if (!coin.collected) {
          ctx.fillStyle = '#f1c40f';
          ctx.beginPath();
          ctx.arc(coin.x, coin.y, coinSize, 0, Math.PI * 2);
          ctx.fill();
          ctx.strokeStyle = '#f39c12';
          ctx.lineWidth = 2;
          ctx.stroke();
        }
      });
      
      // í”Œë ˆì´ì–´ (ìºë¦­í„° ì´ë¯¸ì§€)
      if (player.image.complete) {
        ctx.drawImage(
          player.image,
          player.x - player.displayWidth / 2,
          player.y - player.displayHeight / 2,
          player.displayWidth,
          player.displayHeight
        );
      } else {
        // ì´ë¯¸ì§€ ë¡œë”© ì¤‘ì´ë©´ ì„ì‹œë¡œ ì‚¬ê°í˜• í‘œì‹œ
        ctx.fillStyle = '#3498db';
        ctx.fillRect(
          player.x - player.displayWidth / 2,
          player.y - player.displayHeight / 2,
          player.displayWidth,
          player.displayHeight
        );
      }
    }

    // ê²Œì„ ë£¨í”„
    function gameLoop() {
      if (gameState !== 'playing') return;
      
      updatePhysics();
      updateCars();
      checkCollisions();
      draw();
      
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>