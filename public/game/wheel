<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>íœ ì²´ì–´ ë³´ë„ ëª¨í—˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      overflow: hidden;
      background: #2c3e50;
      font-family: 'Jua', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      touch-action: none;
    }
    #gameContainer {
      position: relative;
      background: #34495e;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    canvas {
      display: block;
      background: #95a5a6;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* ì¡°ì´ìŠ¤í‹± */
    #joystick {
      position: absolute;
      bottom: 40px;
      left: 40px;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.4);
      display: none;
    }
    #joystick.active {
      display: block;
    }
    #stick {
      position: absolute;
      width: 50px;
      height: 50px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.8);
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: all 0.1s;
    }

    /* UI ì˜¤ë²„ë ˆì´ */
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 18px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    #timer {
      display: none; /* íƒ€ì´ë¨¸ ë¹„í™œì„±í™” */
    }

    /* ì‹œì‘/ì¢…ë£Œ í™”ë©´ */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.8);
      color: white;
      z-index: 10;
    }
    .screen h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    .screen p {
      font-size: 20px;
      margin: 10px 0;
    }
    .screen button {
      margin-top: 20px;
      padding: 15px 40px;
      font-size: 24px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Jua', sans-serif;
    }
    .screen button:hover {
      background: #2980b9;
    }
    #endScreen {
      display: none;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <!-- UI -->
    <div id="ui">
      <div id="timer">ì‹œê°„: <span id="timeLeft">0</span>ì´ˆ</div>
    </div>

    <!-- ì¡°ì´ìŠ¤í‹± -->
    <div id="joystick">
      <div id="stick"></div>
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="screen">
      <h1>ğŸ¦½ íœ ì²´ì–´ ë³´ë„ ëª¨í—˜</h1>
      <p>ë³¼ë¼ë“œ ì‚¬ì´ë¥¼ í†µê³¼í•´ì„œ ê²°ìŠ¹ì„ ì— ë„ì°©í•˜ì„¸ìš”!</p>
      <p style="font-size: 16px; color: #bdc3c7;">ì¡°ì´ìŠ¤í‹±ìœ¼ë¡œ ì´ë™ (ê´€ì„± ì‹œìŠ¤í…œ)</p>
      <button onclick="startGame()">ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- ì¢…ë£Œ í™”ë©´ -->
    <div id="endScreen" class="screen">
      <h1 id="endTitle">ì„±ê³µ!</h1>
      <p id="endMessage">ê²°ìŠ¹ì„ ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!</p>
      <button onclick="resetGame()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // ê²Œì„ ìƒíƒœ
    let gameState = 'start'; // start, playing, end
    let timeLeft = 0;
    let timerEnabled = false; // íƒ€ì´ë¨¸ ë¹„í™œì„±í™”

    // í”Œë ˆì´ì–´
    const player = {
      x: canvas.width / 2,
      y: canvas.height - 80,
      width: 24,
      height: 24,
      velocityX: 0,
      velocityY: 0,
      acceleration: 0.4,
      friction: 0.92,
      maxSpeed: 4
    };

    // ë³¼ë¼ë“œ (ì¥ì• ë¬¼)
    const bollards = [
      // êµ¬ê°„ 1
      { x: 80, y: 500, width: 20, height: 20 },
      { x: 300, y: 500, width: 20, height: 20 },
      
      // êµ¬ê°„ 2
      { x: 120, y: 400, width: 20, height: 20 },
      { x: 260, y: 400, width: 20, height: 20 },
      
      // êµ¬ê°„ 3
      { x: 100, y: 300, width: 20, height: 20 },
      { x: 280, y: 300, width: 20, height: 20 },
      
      // êµ¬ê°„ 4 (ì¢ì•„ì§)
      { x: 140, y: 200, width: 20, height: 20 },
      { x: 240, y: 200, width: 20, height: 20 },
      
      // êµ¬ê°„ 5
      { x: 90, y: 100, width: 20, height: 20 },
      { x: 290, y: 100, width: 20, height: 20 },
    ];

    // ê²°ìŠ¹ì„ 
    const finishLine = 50;

    // ì¡°ì´ìŠ¤í‹±
    const joystick = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let joystickActive = false;
    let joystickInput = { x: 0, y: 0 };

    // í„°ì¹˜ ì´ë²¤íŠ¸
    canvas.addEventListener('touchstart', handleTouchStart);
    canvas.addEventListener('touchmove', handleTouchMove);
    canvas.addEventListener('touchend', handleTouchEnd);

    function handleTouchStart(e) {
      e.preventDefault();
      if (gameState !== 'playing') return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const touchX = touch.clientX - rect.left;
      const touchY = touch.clientY - rect.top;
      
      // ì¡°ì´ìŠ¤í‹± í™œì„±í™”
      joystick.style.left = touchX - 60 + 'px';
      joystick.style.top = touchY - 60 + 'px';
      joystick.classList.add('active');
      joystickActive = true;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (!joystickActive) return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const touchX = touch.clientX - rect.left;
      const touchY = touch.clientY - rect.top;
      
      const joystickRect = joystick.getBoundingClientRect();
      const centerX = joystickRect.left + joystickRect.width / 2 - rect.left;
      const centerY = joystickRect.top + joystickRect.height / 2 - rect.top;
      
      let deltaX = touchX - centerX;
      let deltaY = touchY - centerY;
      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
      const maxDistance = 35;
      
      if (distance > maxDistance) {
        const angle = Math.atan2(deltaY, deltaX);
        deltaX = Math.cos(angle) * maxDistance;
        deltaY = Math.sin(angle) * maxDistance;
      }
      
      stick.style.left = (60 + deltaX) + 'px';
      stick.style.top = (60 + deltaY) + 'px';
      
      joystickInput.x = deltaX / maxDistance;
      joystickInput.y = deltaY / maxDistance;
    }

    function handleTouchEnd(e) {
      e.preventDefault();
      joystick.classList.remove('active');
      joystickActive = false;
      stick.style.left = '50%';
      stick.style.top = '50%';
      joystickInput = { x: 0, y: 0 };
    }

    // ê²Œì„ ì‹œì‘
    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      gameState = 'playing';
      resetPlayer();
      if (timerEnabled) {
        timeLeft = 60;
        startTimer();
      }
      gameLoop();
    }

    // ê²Œì„ ë¦¬ì…‹
    function resetGame() {
      document.getElementById('endScreen').style.display = 'none';
      gameState = 'playing';
      resetPlayer();
      if (timerEnabled) {
        timeLeft = 60;
        startTimer();
      }
    }

    function resetPlayer() {
      player.x = canvas.width / 2;
      player.y = canvas.height - 80;
      player.velocityX = 0;
      player.velocityY = 0;
    }

    // íƒ€ì´ë¨¸ (ë¹„í™œì„±í™”)
    function startTimer() {
      const interval = setInterval(() => {
        if (gameState !== 'playing') {
          clearInterval(interval);
          return;
        }
        timeLeft--;
        document.getElementById('timeLeft').textContent = timeLeft;
        if (timeLeft <= 0) {
          endGame(false);
          clearInterval(interval);
        }
      }, 1000);
    }

    // ë¬¼ë¦¬ ì—…ë°ì´íŠ¸
    function updatePhysics() {
      // ì¡°ì´ìŠ¤í‹± ì…ë ¥ì— ë”°ë¥¸ ê°€ì†
      player.velocityX += joystickInput.x * player.acceleration;
      player.velocityY += joystickInput.y * player.acceleration;
      
      // ì†ë„ ì œí•œ
      const speed = Math.sqrt(player.velocityX ** 2 + player.velocityY ** 2);
      if (speed > player.maxSpeed) {
        const ratio = player.maxSpeed / speed;
        player.velocityX *= ratio;
        player.velocityY *= ratio;
      }
      
      // ë§ˆì°°ë ¥ ì ìš©
      player.velocityX *= player.friction;
      player.velocityY *= player.friction;
      
      // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      player.x += player.velocityX;
      player.y += player.velocityY;
      
      // í™”ë©´ ê²½ê³„ ì œí•œ
      if (player.x < player.width / 2) {
        player.x = player.width / 2;
        player.velocityX = 0;
      }
      if (player.x > canvas.width - player.width / 2) {
        player.x = canvas.width - player.width / 2;
        player.velocityX = 0;
      }
      if (player.y < player.height / 2) {
        player.y = player.height / 2;
        player.velocityY = 0;
      }
      if (player.y > canvas.height - player.height / 2) {
        player.y = canvas.height - player.height / 2;
        player.velocityY = 0;
      }
    }

    // ì¶©ëŒ ê°ì§€
    function checkCollisions() {
      bollards.forEach(bollard => {
        if (isColliding(player, bollard)) {
          // íŠ•ê²¨ë‚´ê¸°
          const dx = player.x - (bollard.x + bollard.width / 2);
          const dy = player.y - (bollard.y + bollard.height / 2);
          const distance = Math.sqrt(dx * dx + dy * dy);
          
          if (distance > 0) {
            const pushX = (dx / distance) * 3;
            const pushY = (dy / distance) * 3;
            player.velocityX = pushX;
            player.velocityY = pushY;
          }
        }
      });
      
      // ê²°ìŠ¹ì„  ì²´í¬
      if (player.y < finishLine) {
        endGame(true);
      }
    }

    function isColliding(rect1, rect2) {
      return rect1.x < rect2.x + rect2.width &&
             rect1.x + rect1.width > rect2.x &&
             rect1.y < rect2.y + rect2.height &&
             rect1.y + rect1.height > rect2.y;
    }

    // ê²Œì„ ì¢…ë£Œ
    function endGame(victory) {
      gameState = 'end';
      const endScreen = document.getElementById('endScreen');
      const endTitle = document.getElementById('endTitle');
      const endMessage = document.getElementById('endMessage');
      
      if (victory) {
        endTitle.textContent = 'ğŸ‰ ì„±ê³µ!';
        endMessage.textContent = 'ê²°ìŠ¹ì„ ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤!';
      } else {
        endTitle.textContent = 'â° ì‹œê°„ ì¢…ë£Œ';
        endMessage.textContent = 'ì‹œê°„ì´ ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!';
      }
      
      endScreen.style.display = 'flex';
    }

    // ê·¸ë¦¬ê¸°
    function draw() {
      // ë°°ê²½ (ë³´ë„)
      ctx.fillStyle = '#7f8c8d';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // ë³´ë„ ë¼ì¸
      ctx.strokeStyle = '#95a5a6';
      ctx.lineWidth = 2;
      for (let i = 0; i < canvas.height; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
      }
      
      // ê²°ìŠ¹ì„ 
      ctx.fillStyle = '#f1c40f';
      ctx.fillRect(0, finishLine - 10, canvas.width, 20);
      ctx.fillStyle = '#2c3e50';
      ctx.font = 'bold 16px Jua';
      ctx.textAlign = 'center';
      ctx.fillText('ê²°ìŠ¹ì„ ', canvas.width / 2, finishLine + 5);
      
      // ë³¼ë¼ë“œ
      ctx.fillStyle = '#e74c3c';
      bollards.forEach(bollard => {
        ctx.fillRect(bollard.x, bollard.y, bollard.width, bollard.height);
        ctx.strokeStyle = '#c0392b';
        ctx.lineWidth = 2;
        ctx.strokeRect(bollard.x, bollard.y, bollard.width, bollard.height);
      });
      
      // í”Œë ˆì´ì–´ (ì„ì‹œ ì‚¬ê°í˜• - ë‚˜ì¤‘ì— í”½ì…€ì•„íŠ¸ë¡œ êµì²´)
      ctx.fillStyle = '#3498db';
      ctx.fillRect(
        player.x - player.width / 2,
        player.y - player.height / 2,
        player.width,
        player.height
      );
      ctx.strokeStyle = '#2980b9';
      ctx.lineWidth = 2;
      ctx.strokeRect(
        player.x - player.width / 2,
        player.y - player.height / 2,
        player.width,
        player.height
      );
    }

    // ê²Œì„ ë£¨í”„
    function gameLoop() {
      if (gameState !== 'playing') return;
      
      updatePhysics();
      checkCollisions();
      draw();
      
      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>